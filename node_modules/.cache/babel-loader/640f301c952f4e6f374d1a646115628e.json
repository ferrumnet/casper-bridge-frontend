{"ast":null,"code":"import _slicedToArray from\"/Users/kabiribraheem/Documents/casper-bridge-frontend/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _regeneratorRuntime from\"/Users/kabiribraheem/Documents/casper-bridge-frontend/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"/Users/kabiribraheem/Documents/casper-bridge-frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import React,{useEffect}from\"react\";import{useSelector,useDispatch}from\"react-redux\";import*as applicationWrapperActions from\"./redux/walletApplicationWrapperActions\";import FerrumJson from\"../../../utils/FerrumToken.json\";// import { Networks } from \"ferrum-plumbing\";\n// import { FRM } from \"../../helper/bridgeHelpers\";\nimport Web3 from\"web3\";import{Big}from\"big.js\";import{Web3ReactProvider}from\"@web3-react/core\";import{jsx as _jsx}from\"react/jsx-runtime\";var getLibrary=function getLibrary(provider){return new Web3(provider);// this will vary according to whether you use e.g. ethers or web3.js\n};export var ApplicationWrapper=function ApplicationWrapper(_ref){var children=_ref.children;var dispatch=useDispatch();var _useSelector=useSelector(function(state){return state.casper.walletConnector;}),isConnected=_useSelector.isConnected,walletAddress=_useSelector.walletAddress,currentWalletNetwork=_useSelector.currentWalletNetwork,networkClient=_useSelector.networkClient,isWeb3Initialized=_useSelector.isWeb3Initialized;var _useSelector2=useSelector(function(state){return state.casper.walletApplicationWrapper;}),tokenList=_useSelector2.tokenList,walletWrapperInitialized=_useSelector2.walletWrapperInitialized,groupInfo=_useSelector2.groupInfo;useEffect(function(){// console.log(\"Attempt to intialize app\");\n// dispatch(applicationWrapperActions.loadWalletDefaults(\"frm\", tokenList));\n},[]);useEffect(function(){// console.log(\"intiialalalal\");\nif(isConnected&&isWeb3Initialized&&networkClient&&walletWrapperInitialized){signIntoServer();}else if(!isConnected||!isWeb3Initialized||!networkClient||!walletWrapperInitialized){dispatch(applicationWrapperActions.resetUserProfile());}// eslint-disable-next-line\n},[isConnected,walletWrapperInitialized]);var signIntoServer=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(){return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return getUserProfile();case 2:case\"end\":return _context.stop();}}},_callee);}));return function signIntoServer(){return _ref2.apply(this,arguments);};}();var getUserProfile=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee3(){var _userTokens$,userTokens,currentNetwork,currencies,addressesF,addresses,accountGroups,up;return _regeneratorRuntime().wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:if(!(networkClient!==undefined)){_context3.next=11;break;}userTokens=tokenList.filter(function(item){return item.chainId===currentWalletNetwork;});currentNetwork=(_userTokens$=userTokens[0])===null||_userTokens$===void 0?void 0:_userTokens$.currency.split(\":\")[0];currencies=groupInfo.bridgeCurrencies.filter(function(currency){return currency.split(\":\")[0]===currentNetwork;});addressesF=currencies.map(/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(c){var _c$split,_c$split2,network,tokenAddr,symbol,decimals,name,amount,balance,tokenContract,decimalFactor;return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_c$split=c.split(\":\"),_c$split2=_slicedToArray(_c$split,2),network=_c$split2[0],tokenAddr=_c$split2[1];symbol=\"\";decimals=\"\";name=\"\";amount=0;balance=0;// let decimalFactor;\n// const netObj = Networks.for(network);\nif(!(network===currentNetwork)){_context2.next=22;break;}// if (netObj.baseSymbol === tokenAddr) {\n//   symbol = \"\";\n//   if (!!networkClient) {\n//     balance = Web3.utils.fromWei(\n//       await networkClient!.eth.getBalance(walletAddress as string)\n//     );\n//     // console.log(balance, \"==================\");\n//   } else {\n//     balance = \"0\";\n//   }\n// } else {\n// const token = TokenInfo[c];\n// symbol = token.tokenSymbol;\ntokenContract=new networkClient.eth.Contract(FerrumJson.abi,tokenAddr);_context2.next=10;return tokenContract.methods.symbol().call();case 10:symbol=_context2.sent;_context2.next=13;return tokenContract.methods.decimals().call();case 13:decimals=_context2.sent;_context2.next=16;return tokenContract.methods.name().call();case 16:name=_context2.sent;_context2.next=19;return tokenContract.methods.balanceOf(walletAddress).call();case 19:balance=_context2.sent;decimalFactor=Math.pow(10,Number(decimals));balance=new Big(balance).div(decimalFactor).toFixed();// }\ncase 22:return _context2.abrupt(\"return\",{address:walletAddress.toLocaleLowerCase(),addressType:\"ADDRESS\",balance:balance,currency:c,amount:amount,humanReadableAddress:walletAddress,network:currentNetwork||undefined,pendingForDeposit:\"0\",pendingForWithdrawal:\"0\",symbol:symbol,decimals:decimals,name:name,addressWithChecksum:walletAddress});case 23:case\"end\":return _context2.stop();}}},_callee2);}));return function(_x){return _ref4.apply(this,arguments);};}());_context3.next=7;return Promise.all(addressesF);case 7:addresses=_context3.sent;accountGroups={id:\"ag1\",addresses:addresses};up={appId:\"base\",displayName:\"\",userId:walletAddress,accountGroups:[accountGroups],currentNetwork:currentNetwork};return _context3.abrupt(\"return\",up);case 11:case\"end\":return _context3.stop();}}},_callee3);}));return function getUserProfile(){return _ref3.apply(this,arguments);};}();return/*#__PURE__*/_jsx(Web3ReactProvider,{getLibrary:getLibrary,children:children});};","map":{"version":3,"names":["React","useEffect","useSelector","useDispatch","applicationWrapperActions","FerrumJson","Web3","Big","Web3ReactProvider","getLibrary","provider","ApplicationWrapper","children","dispatch","state","casper","walletConnector","isConnected","walletAddress","currentWalletNetwork","networkClient","isWeb3Initialized","walletApplicationWrapper","tokenList","walletWrapperInitialized","groupInfo","signIntoServer","resetUserProfile","getUserProfile","undefined","userTokens","filter","item","chainId","currentNetwork","currency","split","currencies","bridgeCurrencies","addressesF","map","c","network","tokenAddr","symbol","decimals","name","amount","balance","tokenContract","eth","Contract","abi","methods","call","balanceOf","decimalFactor","Number","div","toFixed","address","toLocaleLowerCase","addressType","humanReadableAddress","pendingForDeposit","pendingForWithdrawal","addressWithChecksum","Promise","all","addresses","accountGroups","id","up","appId","displayName","userId"],"sources":["/Users/kabiribraheem/Documents/casper-bridge-frontend/src/components/connector/wallet-application-wrapper/walletApplicationWrapper.tsx"],"sourcesContent":["import React, { useEffect } from \"react\";\nimport { useSelector, useDispatch } from \"react-redux\";\nimport * as applicationWrapperActions from \"./redux/walletApplicationWrapperActions\";\nimport FerrumJson from \"../../../utils/FerrumToken.json\";\n// import { Networks } from \"ferrum-plumbing\";\n// import { FRM } from \"../../helper/bridgeHelpers\";\nimport { RootState } from \"../../../redux/rootReducer\";\nimport Web3 from \"web3\";\nimport { Big } from \"big.js\";\nimport { AbiItem } from \"web3-utils\";\nimport { Web3ReactProvider } from \"@web3-react/core\";\n\nconst getLibrary = (provider: any) => {\n  return new Web3(provider); // this will vary according to whether you use e.g. ethers or web3.js\n};\n\nexport const ApplicationWrapper = ({ children }: any) => {\n  const dispatch = useDispatch();\n\n  const {\n    isConnected,\n    walletAddress,\n    currentWalletNetwork,\n    // walletBalance,\n    networkClient,\n    isWeb3Initialized,\n  } = useSelector((state: RootState) => state.casper.walletConnector);\n\n  const {\n    tokenList,\n    walletWrapperInitialized,\n    // supportedCurrencies,\n    groupInfo,\n  } = useSelector((state: RootState) => state.casper.walletApplicationWrapper);\n\n  useEffect(() => {\n    // console.log(\"Attempt to intialize app\");\n    // dispatch(applicationWrapperActions.loadWalletDefaults(\"frm\", tokenList));\n  }, []);\n\n  useEffect(() => {\n    // console.log(\"intiialalalal\");\n    if (\n      isConnected &&\n      isWeb3Initialized &&\n      networkClient &&\n      walletWrapperInitialized\n    ) { \n      signIntoServer();\n    } else if (\n      !isConnected ||\n      !isWeb3Initialized ||\n      !networkClient ||\n      !walletWrapperInitialized\n    ) { \n      dispatch(applicationWrapperActions.resetUserProfile());\n    }\n    // eslint-disable-next-line\n  }, [isConnected, walletWrapperInitialized]);\n\n  const signIntoServer = async () => { \n     await getUserProfile(); \n    // dispatch(applicationWrapperActions.getUserProfile(user));\n  };\n\n  const getUserProfile = async () => {\n    if (networkClient !== undefined) {\n      const userTokens = tokenList.filter((item: any) => {\n        return item.chainId === currentWalletNetwork;\n      });\n      const currentNetwork = userTokens[0]?.currency.split(\":\")[0];\n      const currencies = groupInfo.bridgeCurrencies.filter(\n        (currency: any) => currency.split(\":\")[0] === currentNetwork\n      );\n      const addressesF = currencies.map(async (c: any) => {\n        const [network, tokenAddr] = c.split(\":\");\n        let symbol: string = \"\";\n        let decimals: string = \"\";\n        let name: string = \"\";\n        let amount: number | string = 0;\n        let balance: number | string = 0;\n        // let decimalFactor;\n        // const netObj = Networks.for(network);\n        if (network === currentNetwork) {\n          // if (netObj.baseSymbol === tokenAddr) {\n          //   symbol = \"\";\n          //   if (!!networkClient) {\n          //     balance = Web3.utils.fromWei(\n          //       await networkClient!.eth.getBalance(walletAddress as string)\n          //     );\n          //     // console.log(balance, \"==================\");\n          //   } else {\n          //     balance = \"0\";\n          //   }\n          // } else {\n          // const token = TokenInfo[c];\n          // symbol = token.tokenSymbol;\n          const tokenContract = new networkClient.eth.Contract(\n            FerrumJson.abi as AbiItem[],\n            tokenAddr\n          );\n          symbol = await tokenContract.methods.symbol().call();\n          decimals = (await tokenContract.methods.decimals().call()) as any;\n          name = await tokenContract.methods.name().call();\n          balance = await tokenContract.methods.balanceOf(walletAddress).call();\n          const decimalFactor = 10 ** Number(decimals);\n          balance = new Big(balance).div(decimalFactor).toFixed();  \n          // }\n        }\n\n        return {\n          address: walletAddress.toLocaleLowerCase(),\n          addressType: \"ADDRESS\",\n          balance: balance,\n          currency: c,\n          amount,\n          humanReadableAddress: walletAddress,\n          network: currentNetwork || undefined,\n          pendingForDeposit: \"0\",\n          pendingForWithdrawal: \"0\",\n          symbol,\n          decimals,\n          name,\n          addressWithChecksum: walletAddress,\n        };\n      });\n      const addresses = await Promise.all(addressesF);\n      const accountGroups = {\n        id: \"ag1\",\n        addresses,\n      };\n      const up = {\n        appId: \"base\",\n        displayName: \"\",\n        userId: walletAddress,\n        accountGroups: [accountGroups],\n        currentNetwork,\n      };\n      return up;\n    }\n  };\n\n  return (\n    <Web3ReactProvider getLibrary={getLibrary}>{children}</Web3ReactProvider>\n  );\n};\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}