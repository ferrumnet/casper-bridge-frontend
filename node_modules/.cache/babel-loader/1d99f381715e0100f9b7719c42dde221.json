{"ast":null,"code":"import _regeneratorRuntime from\"/Users/kabiribraheem/Documents/casper-bridge-frontend/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"/Users/kabiribraheem/Documents/casper-bridge-frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/Users/kabiribraheem/Documents/casper-bridge-frontend/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import{CasperClient,CasperServiceByJsonRPC}from\"casper-js-sdk\";import{FDialog,FList,FTruncateText,FTypo}from\"ferrum-design-system\";import{useEffect,useState}from\"react\";import Loader from\"./../assets/images/loaderIcon.svg\";import Success from\"./../assets/images/SuccessIcon.svg\";import Failure from\"./../assets/images/FailureIcon.svg\";import LoaderGif from\"./../assets/images/loading2.gif\";import{crucibleApi}from\"../client\";import{useSelector}from\"react-redux\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var RPC_API=\"http://44.208.234.65:7777/rpc\";var casperService=new CasperServiceByJsonRPC(RPC_API);var casperClient=new CasperClient(RPC_API);var ConfirmationDialog=function ConfirmationDialog(_ref){var show=_ref.show,_onHide=_ref.onHide,message=_ref.message,transaction=_ref.transaction,amount=_ref.amount,_ref$isSwap=_ref.isSwap,isSwap=_ref$isSwap===void 0?false:_ref$isSwap;var _useState=useState(false),_useState2=_slicedToArray(_useState,2),processing=_useState2[0],setProcessing=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),isSuccessful=_useState4[0],setIsSuccessful=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),isDone=_useState6[0],setIsDone=_useState6[1];var _useState7=useState(null),_useState8=_slicedToArray(_useState7,2),intervalId=_useState8[0],setIntervalId=_useState8[1];var _useSelector=useSelector(function(state){return state.casper;}),_useSelector$connect=_useSelector.connect,config=_useSelector$connect.config,selectedAccount=_useSelector$connect.selectedAccount,isWalletConnected=_useSelector$connect.isWalletConnected,signedAddresses=_useSelector$connect.signedAddresses;var _useSelector2=useSelector(function(state){return state.casper.walletConnector;}),walletAddress=_useSelector2.walletAddress;var checkTransaction=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(){var res,Api,logTransaction;return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:setProcessing(true);_context.next=3;return casperService.getDeployInfo(transaction);case 3:res=_context.sent;console.log(res);if(!res.execution_results.length){_context.next=21;break;}console.log(res);//@ts-ignore\nif(res.execution_results[0].result.Failure){//@ts-ignore\nconsole.log(res.execution_results[0].result.Failure.error_message,'res[0].result.Failure');setProcessing(false);setIsDone(true);setIsSuccessful(false);}//@ts-ignore\nif(!res.execution_results[0].result.Success){_context.next=21;break;}//@ts-ignore\nconsole.log(res.execution_results[0].result.Success);setProcessing(false);setIsDone(true);setIsSuccessful(true);if(!isSwap){_context.next=21;break;}Api=new crucibleApi();_context.next=17;return Api.signInToServer(walletAddress);case 17:_context.next=19;return Api.gatewayApi({command:'logEvmAndNonEvmTransaction',data:{receiveNetwork:'56',sendAmount:amount,sendAddress:\"\".concat(selectedAccount===null||selectedAccount===void 0?void 0:selectedAccount.address),sendNetwork:'109090',sendTimestamp:Date.now(),sendCurrencyS:\"CSPR:222974816f70ca96fc4002a696bb552e2959d3463158cd82a7bfc8a94c03473\",receiveCurrency:'BSC_TESTNET:0xfe00ee6f00dd7ed533157f6250656b4e007e7179',creator:\"cspr:\".concat(selectedAccount===null||selectedAccount===void 0?void 0:selectedAccount.address),id:transaction},params:[]});case 19:logTransaction=_context.sent;console.log(logTransaction);case 21:case\"end\":return _context.stop();}}},_callee);}));return function checkTransaction(){return _ref2.apply(this,arguments);};}();useEffect(function(){console.log(transaction,isDone);if(transaction&&!isDone){var _intervalId=setInterval(function(){return checkTransaction();},5000);setIntervalId(_intervalId);}if(transaction&&isDone){console.log(intervalId);clearInterval(intervalId);}},[transaction,isDone]);useEffect(function(){return function(){setIsDone(false);setIsSuccessful(false);setProcessing(false);};},[]);return/*#__PURE__*/_jsx(FDialog,{variant:\"dark\",size:\"medium\",onHide:function onHide(){return _onHide();},show:show,className:\"connect-wallet-dialog text-center\",showClose:true,title:\"\",children:/*#__PURE__*/_jsxs(FList,{display:\"block\",type:\"number\",variant:\"connect-wallet\",children:[isDone&&transaction?isSuccessful?/*#__PURE__*/_jsx(\"img\",{src:Success,width:\"120px\"}):/*#__PURE__*/_jsx(\"img\",{src:Failure,width:\"120px\"}):transaction&&processing?/*#__PURE__*/_jsx(\"img\",{src:LoaderGif,width:\"120px\"}):/*#__PURE__*/_jsx(\"img\",{src:Loader,width:\"120px\"}),/*#__PURE__*/_jsx(FTypo,{size:20,className:\"f-mb--5 f-mt--9\",children:isDone&&transaction?isSuccessful?'Transaction processed successfully':'Transaction failed on chain':message||'Loading'}),/*#__PURE__*/_jsx(\"a\",{href:\"https://testnet.cspr.live/deploy/\".concat(transaction),target:\"_blank\",style:{\"color\":\"white\"},children:/*#__PURE__*/_jsx(FTypo,{size:15,className:\"f-mb--5 f-mt--9\",children:/*#__PURE__*/_jsx(FTruncateText,{text:transaction})})})]})});};export default ConfirmationDialog;","map":{"version":3,"names":["CasperClient","CasperServiceByJsonRPC","FDialog","FList","FTruncateText","FTypo","useEffect","useState","LoaderGif","crucibleApi","useSelector","RPC_API","casperService","casperClient","ConfirmationDialog","show","onHide","message","transaction","amount","isSwap","processing","setProcessing","isSuccessful","setIsSuccessful","isDone","setIsDone","intervalId","setIntervalId","state","casper","connect","config","selectedAccount","isWalletConnected","signedAddresses","walletConnector","walletAddress","checkTransaction","getDeployInfo","res","console","log","execution_results","length","result","Failure","error_message","Success","Api","signInToServer","gatewayApi","command","data","receiveNetwork","sendAmount","sendAddress","address","sendNetwork","sendTimestamp","Date","now","sendCurrencyS","receiveCurrency","creator","id","params","logTransaction","setInterval","clearInterval","Loader"],"sources":["/Users/kabiribraheem/Documents/casper-bridge-frontend/src/dialogs/ConfirmationDialog.tsx"],"sourcesContent":["import { CasperClient, CasperServiceByJsonRPC } from \"casper-js-sdk\";\nimport { FDialog, FList, FTruncateText, FTypo, FLink } from \"ferrum-design-system\";\nimport { useEffect, useState } from \"react\";\nimport Loader from \"./../assets/images/loaderIcon.svg\";\nimport Success from \"./../assets/images/SuccessIcon.svg\";\nimport Failure from \"./../assets/images/FailureIcon.svg\";\nimport LoaderGif from \"./../assets/images/loading2.gif\";\nimport { crucibleApi } from \"../client\";\nimport { useSelector } from \"react-redux\";\n\nconst RPC_API = \"http://44.208.234.65:7777/rpc\";\n\nconst casperService = new CasperServiceByJsonRPC(RPC_API);\nconst casperClient = new CasperClient(RPC_API);\n\nconst ConfirmationDialog = ({\n    show,\n    onHide,\n    message,\n    transaction,\n    amount,\n    isSwap = false,\n  }: any) => {\n    const [processing, setProcessing] = useState(false)\n    const [isSuccessful, setIsSuccessful] = useState(false)\n    const [isDone, setIsDone] = useState(false)\n    const [intervalId, setIntervalId] = useState(null as any)\n    const { connect: { config, selectedAccount, isWalletConnected, signedAddresses, } } = useSelector((state: any) => state.casper);\n    const { walletAddress } = useSelector((state: any) => state.casper.walletConnector);\n\n    const checkTransaction = async () => {\n        setProcessing(true)\n        const res = await casperService.getDeployInfo(transaction)\n        console.log(res);\n        if(res.execution_results.length) {\n            console.log(res)\n           //@ts-ignore\n           if(res.execution_results[0].result.Failure) {\n            //@ts-ignore\n            console.log(res.execution_results[0].result.Failure.error_message, 'res[0].result.Failure')\n            setProcessing(false)\n            setIsDone(true)\n            setIsSuccessful(false)\n           }\n           //@ts-ignore\n           if(res.execution_results[0].result.Success) {\n            //@ts-ignore\n            console.log(res.execution_results[0].result.Success)\n            setProcessing(false)\n            setIsDone(true)\n            setIsSuccessful(true)\n            if (isSwap) {\n              const Api = new crucibleApi()\n              await Api.signInToServer(walletAddress)\n              const logTransaction = await Api.gatewayApi({\n                command: 'logEvmAndNonEvmTransaction', data: {\n                  receiveNetwork: '56',\n                  sendAmount: amount,\n                  sendAddress: `${selectedAccount?.address}`,\n                  sendNetwork: '109090',\n                  sendTimestamp: Date.now(),\n                  sendCurrencyS: `CSPR:222974816f70ca96fc4002a696bb552e2959d3463158cd82a7bfc8a94c03473`,\n                  receiveCurrency: 'BSC_TESTNET:0xfe00ee6f00dd7ed533157f6250656b4e007e7179',\n                  creator: `cspr:${selectedAccount?.address}`,\n                  id: transaction\n              }, params: [] });\n              console.log(logTransaction);\n            }\n           \n           }\n        }\n    }\n    useEffect(() => {\n        console.log(transaction, isDone)\n        if (transaction && !isDone) {\n          let intervalId = setInterval(\n            () =>  checkTransaction()\n          , 5000)\n          setIntervalId(intervalId)\n        }\n\n        if (transaction && isDone) {\n          console.log(intervalId)\n          clearInterval(intervalId)\n        }\n    }, [transaction, isDone])\n\n    useEffect(() => {\n      return () => {\n        setIsDone(false)\n        setIsSuccessful(false)\n        setProcessing(false)\n      }\n    }, [])\n\n    return (\n      <FDialog\n        variant={\"dark\"}\n        size={\"medium\"}\n        onHide={() => onHide()}\n        show={show}\n        className=\"connect-wallet-dialog text-center\"\n        showClose={true}\n        title={\"\"}\n      >\n        <FList display=\"block\" type=\"number\" variant=\"connect-wallet\">\n          {\n            isDone && transaction ?\n              isSuccessful ?\n                <img src={Success} width={\"120px\"} />\n              : <img src={Failure} width={\"120px\"} />\n            : transaction && processing ?\n              <img src={LoaderGif} width={\"120px\"} />\n            : <img src={Loader} width={\"120px\"} />\n          }\n          <FTypo size={20} className={\"f-mb--5 f-mt--9\"}> \n            {\n              isDone && transaction ?\n               isSuccessful ?\n                  ('Transaction processed successfully')\n               : ('Transaction failed on chain')\n              :  (message || 'Loading')\n            }\n          </FTypo>\n          <a href={`https://testnet.cspr.live/deploy/${transaction}`} target=\"_blank\" style={{\"color\": \"white\"}}>\n            <FTypo size={15} className={\"f-mb--5 f-mt--9\"}>\n              <FTruncateText text={transaction} />\n            </FTypo>\n          </a>\n        </FList>\n        {/* <FButton onClick={onHide} title={\"Close\"}></FButton> */}\n      </FDialog>\n    );\n  };\n  \nexport default ConfirmationDialog\n  "],"mappings":"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"},"metadata":{},"sourceType":"module"}